<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="admin/layout/layout1">
<head>
<meta charset="UTF-8">
<title>ì¬ê³ í™•ì¸</title>
<th:block layout:fragment="style">
	<style>
		.hidden-col {display: none}
	</style>
</th:block>


</head>
<body>

	<div layout:fragment="content">
		<h3>ğŸ“‘ ì¬ê³ í˜„í™©</h3>
		<hr>
		<div id="searchBox" class="mt-5">
			<div class="input-group mb-5">
				<div class="input-group-prepend">
					<span class="input-group-text">ê²€ìƒ‰ì–´</span>
				</div>
				<input type="text" id="searchKeyword1" class="form-control"	th:value="${pageVO.keyword!=null?pageVO.keyword[0]:''}"
					placeholder="ìƒí’ˆëª… ì…ë ¥" onfocus="this.placeholder=''" onblur="this.placeholder='ìƒí’ˆëª… ì…ë ¥'"> 
				<input type="text" id="searchKeyword2" class="form-control" th:value="${pageVO.keyword!=null?pageVO.keyword[1]:''}"
					placeholder="ìƒí’ˆë²ˆí˜¸ ì…ë ¥" onfocus="this.placeholder=''" onblur="this.placeholder='ìƒí’ˆë²ˆí˜¸ ì…ë ¥'">
			</div>
		
			<div id="statePosting">
				<label for="statePosting" class="mr-4">ì¬ê³ ìƒíƒœ</label>
				<div class="form-check-inline">
					<label class="form-check-label">
					<input type="radio" class="form-check-input" id="all" name="stockState" value="ì „ì²´"
						th:checked="${pageVO.keyword==null || pageVO.keyword[2]=='ì „ì²´'}">ì „ì²´</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label">
					<input type="radio" class="form-check-input" value="ì •ìƒ" name="stockState"
						th:checked="${pageVO.keyword!=null && pageVO.keyword[2]=='ì •ìƒ'}">ì •ìƒ</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label">
					<input type="radio" class="form-check-input" value="ë¶€ì¡±" name="stockState"
						th:checked="${pageVO.keyword!=null && pageVO.keyword[2]=='ë¶€ì¡±'}">ë¶€ì¡±</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label">
					<input type="radio"
						class="form-check-input" value="í’ˆì ˆ" name="stockState" 
						th:checked="${pageVO.keyword!=null && pageVO.keyword[2]=='í’ˆì ˆ'}">í’ˆì ˆ</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label">
					<input type="radio"
						class="form-check-input" value="ì²«ì…ê³ " name="stockState" 
						th:checked="${pageVO.keyword!=null && pageVO.keyword[2]=='ì²«ì…ê³ '}">ì²«ì…ê³ </label>
				</div>
			</div>
			<div class="d-flex justify-content-center mt-4">
				<div>
					<button class="btn mr-3" id="searchBtn"
						style="background-color: #f7edbc">
						<i class="material-icons pt-2 pl-3 pr-3">&nbsp;&nbsp;search&nbsp;&nbsp;</i>
					</button>
				</div>
				<div>
					<button class="btn" id="resetBtn"
						style="background-color: #fcc0c5;">
						<i class="material-icons pt-2 pl-3 pr-3">&nbsp;&nbsp;cached&nbsp;&nbsp;</i>
					</button>
				</div>
			</div>
		</div>
        
		<!-- 			<img alt="ì´ë¯¸ì§€" th:src="@{/images/coffee-blue.jpg}" width="50px"
				height="50px"> -->
		<hr class="mt-4 mb-5">
		<div class="d-flex justify-content-between">
			<div>
				<p th:text="'ì´ ' + ${totalCount} + 'ê±´'"></p>
			</div>
			<div>
				<p th:text="|${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')} ê¸°ì¤€|"></p>
			</div>

			<div class="form-group" style="float:right; width:190px;">
				<select id = "sortColumn" class="form-control"> <!-- asc1 desc0 ê°€ì ¸ê°€ëŠ” ë°©ë²• ì°¾ê¸° -->
					<option value="product_num0" th:selected="${sortColumn=='product_num0'}">ìƒí’ˆë²ˆí˜¸(ì˜¤ë¦„ì°¨ìˆœ)</option>
					<option value="product_num0" th:selected="${sortColumn=='product_num1'}">ìƒí’ˆë²ˆí˜¸(ë‚´ë¦¼ì°¨ìˆœ)</option>
					<option value="total_stock0" th:selected="${sortColumn=='total_stock0'}">ì´ì¬ê³ ëŸ‰(ë†’ì€ìˆœ)</option>
					<option value="total_stock1" th:selected="${sortColumn=='total_stock1'}">ì´ì¬ê³ ëŸ‰(ë‚®ì€ìˆœ)</option>
					<option value="sales_quantity0" th:selected="${sortColumn=='sales_quantity0'}">ê¸ˆì¼íŒë§¤ëŸ‰(ë†’ì€ìˆœ)</option>
					<option value="sales_quantity1" th:selected="${sortColumn=='sales_quantity1'}">ê¸ˆì¼íŒë§¤ëŸ‰(ë‚®ì€ìˆœ)</option>
					<option value="purchase_quantity0" th:selected="${sortColumn=='purchase_quantity0'}">ê¸ˆì¼ì…ê³ ëŸ‰(ë†’ì€ìˆœ)</option>
					<option value="purchase_quantity1" th:selected="${sortColumn=='purchase_quantity1'}">ê¸ˆì¼ì…ê³ ëŸ‰(ë‚®ì€ìˆœ)</option>
				</select>
			</div>
		</div>
		<div>
			<table id="stocklist" class="table table-bordered table-hover">
				<thead>
					<tr>
						<th>No.</th>
						<th>ìƒí’ˆë²ˆí˜¸</th>
						<th>ìƒí’ˆëª…</th>
						<th class="hidden-col">ì˜µì…˜ë²ˆí˜¸</th>
						<th>ì˜µì…˜</th>
 						<th>ê¸ˆì¼ì…ê³ </th>
						<th>ê¸ˆì¼íŒë§¤</th>
						<th>ì´ì¬ê³ ìˆ˜</th>
						<th>ì¬ê³ ìƒíƒœ</th>
						<th>ì…ê³ ë“±ë¡</th>
					</tr>
				</thead>
				<tbody id="myTable">
					<tr th:if="${#lists.size(stockPaging.result.content)}==0">
						<td colspan="10" align="center">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
					</tr>
					<tr th:each="product, state:${stockPaging.result.content}" >
						<td th:text="${state.count + (stockPaging.currentPageNum-1) * stockPaging.currentPage.pageSize}"></td>
						<td th:text="${product[0]}"></td> 
						<td th:text="${product[1]}"></td> 
						<td class="hidden-col" th:text="${product[3]}"></td> <!-- optionNum -->
 						<td th:text="${product[4]}"></td>
 						<td th:text="${product[8]}"></td> 
 						<td th:text="${product[9]}"></td> 
						<td th:text="${product[10] - product[9]}"></td> 
						<td th:text="${product[11]}"></td> 
						<td >
							<a href="#" onclick = "pibtn(this);">ì…ê³ í•˜ê¸°</a> 
								<!-- The Modal -->
							<div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false">
								<div class="modal-dialog modal-dialog-centered" style="max-width: 100%; width: auto; display: table;">
									<div class="modal-content">

										<!-- Modal Header -->
										<div class="modal-header">
											<h4 class="modal-title">ì…ê³ ë“±ë¡</h4>
											<button type="button" class="close" data-dismiss="modal">&times;</button>
										</div>

										<!-- Modal body -->
										<div class="modal-body">
											<form action="stockregister" method="post" id="myfrm">
												<table id="stocklist"class="table table-bordered">
													<tr>
														<th>ìƒí’ˆë²ˆí˜¸</th>
														<td>
															<input type="text" name="productNum" class="form-control-plaintext" readonly/>
														</td>
														<th>ìƒí’ˆëª…</th>
														<td>
															<input type="text" name="productName" class="form-control-plaintext" readonly/>
														</td>
													</tr>
													<tr id="options">
														<th>ì˜µì…˜ë²ˆí˜¸</th>
														<td>
															<input type="text" name="optionNum" class="form-control-plaintext" readonly/> <!-- form-control-plaintext -->
														</td>
														<th>ì˜µì…˜ëª…</th>
														<td>
															<input type="text" name="optionName" class="form-control-plaintext" readonly/> <!-- form-control-plaintext -->
														</td>
													</tr>
													<tr>
														<th >ë‹¨ê°€</th>
														<td colspan="3" id="price"></td>
													</tr>
													<tr>
														<th>ì´ì¬ê³ ìˆ˜ëŸ‰</th>
														<td id="quantity"></td>
														<th>ì ì •ì¬ê³ ìˆ˜ëŸ‰</th>
														<td><span>10</span></td>
													</tr>
													<tr>
														<th>ì…ê³ ìˆ˜ëŸ‰</th>
														<td colspan="3">
															<input type="number" name="purchaseQuantity" class="form-control" min="0" max="1000" required/>
														</td>
	
													</tr>
	
												</table>
												<div class="float-right ">
													<button type="submit" class="btn" style="background-color: #f7edbc;" onClick="checkInputData();">ë“±ë¡</button>
												</div>
												<div>
													<input type="text" name="page" th:value="${stockPaging.currentPageNum}"> 
													<input type="text" name="size" th:value="${stockPaging.currentPage.pageSize}">
													<div th:each="num : ${#numbers.sequence(0,2)}">
														<input type="text" name="type" value=""> 
														<input type="text" name="keyword" value="">
													</div>
													<input type="text" id="sort" name="colmnName" th:value="${sortColumn}">
												</div>
											</form>
										
										</div>
									</div>
								</div>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>	
		<!-- paging -->
		<nav>
		<!--  í˜ì´ì§€ ì—†ì„ë•Œ(previous, next) .disabled ì¶”ê°€ -->
			<div>
				<ul class="pagination justify-content-center">
					<li class="page-item" th:if="${stockPaging.prevPage}">
						<a class="page-link" th:href="${stockPaging.prevPage.pageNumber}+1">PREV</a>
					</li>
					<li class="page-item" th:classappend="${p.pageNumber==stockPaging.currentPageNum-1}?active:''"
						th:each="p:${stockPaging.pageList}">
						<a class="page-link" th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a>
					</li>
					<li class="page-item" th:if="${stockPaging.nextPage}">
						<a class="page-link" th:href="${stockPaging.nextPage.pageNumber}+1">NEXT</a>
					</li>
				</ul>
			</div>
		</nav>


 		<!-- hidden -->
		<form id="f1" th:action="@{stock}" method="get" >
			<input type="hidden" name="page" th:value="${stockPaging.currentPageNum}"> 
			<input type="hidden" name="size" th:value="${stockPaging.currentPage.pageSize}">
			<div th:each="num : ${#numbers.sequence(0,2)}">
				<input type="hidden" name="type" value=""> 
				<input type="hidden" name="keyword" value="">
			</div>
			<input type="hidden" id="sort" name="colmnName" th:value="${sortColumn}">
		</form>
		

	</div>
	<th:block layout:fragment="script">
		<script th:inline="javascript">
		//ì…ê³ ì„±ê³µì‹œ alert
		//functionì—†ìœ¼ë©´ ë¯¸ë¦¬ë¡œë“œ
		$(function(){ //ë¡œë“œê°€ëë‚˜ë©´
	 		var msg = [[${result}]];
			if(msg != null) {
				alert(msg);
			}
		}); 
		
		//ì¬ê³  ìƒíƒœ ì…ë ¥
/* 		var stockQuantity = document.getElementsByClassName("stockQuantity");
		var stockStatus = document.getElementsByClassName("stockStatus");
		console.log(stockQuantity);
 		for(var i = 0; i < stockQuantity.length; i++) {
			console.log(stockQuantity[i].innerHTML);
			var quantity = Number(stockQuantity[i].innerHTML);
			if(quantity <= 0) {
				stockStatus[i].innerHTML = "í’ˆì ˆ"
			} else if(quantity < 10) {
				stockStatus[i].innerHTML = "ë¶€ì¡±"
			} else {
				stockStatus[i].innerHTML = "ì •ìƒ"
			}
		}  */
		
		//ì…ê³ ë“±ë¡ ëª¨ë‹¬ì— ì •ë³´ ë³´ë‚´ê¸°
		function pibtn (obj) {
			var tds = $(obj).parent().parent().find("td"); //ì—¬ëŸ¬ê°œ
	    	var pno = tds[1].innerHTML;
			var ono = tds[3].innerHTML;
			
			if (ono== "" ) ono = 0;
			
			$.ajax({
	            url:"/admin/stockinfo?productNum=" + pno + "&optionNum=" + ono, 
	            success:function(responseData){
	            	$("#options").attr("style", "display:'';");
 					$("input[name='purchaseQuantity']").val("");
					putDataList(responseData);
	                $("#myModal").modal("show");
	            }
	        }); 
			
		}
		
		function putDataList(responseData) {
			var product = responseData.product;
			var option = responseData.productOption;
			$("input[name='productNum']").val(product.productNum);
			$("input[name='productName']").val(product.productName);
			if(option != null){
				$("input[name='optionNum']").val(option.optionNum);
				$("input[name='optionName']").val(option.optionName);
				var price = product.productPrice + option.extraprice;
				$("#price").text(Number(price).toLocaleString('en').split(".")[0] + 'ì›');
				$("#quantity").text(option.optionStock);
			} else {
				$("#options").attr("style", "display:none;");
				$("#price").text(Number(product.productPrice).toLocaleString('en').split(".")[0] + 'ì›');
				$("#quantity").text(product.productStock);
			}
		}
		
		var formObj = $("#f1");
		
		//í˜ì´ì§€ í´ë¦­ì‹œ
		$(".pagination a").click(function(e) { //í´ë˜ìŠ¤ pagination ìì‹ì¤‘ a í´ë¦­ì‹œ 
			e.preventDefault(); //ë§í¬ì·¨ì†Œ
			formObj.find("[name='page']").val($(this).attr('href'));
			$("#searchBtn").click(); //í˜ì´ì§€ë§Œë‹¬ë¼ì§€ê³  ë‹¤ì‹œ ì¡°íšŒ
			//ë‹¤ì‹œ ê·¸ í¼ì—ì„œ ì´ë¦„ì´ pageì¸ê±¸ ì°¾ì•„ì„œ hrefê°€ ê°€ì§€ê³  ìˆëŠ” ìˆ«ìë¥¼ page(this) ê°’ìœ¼ë¡œ ë„£ì–´ì¤Œ
			//formObj.submit(); //ê·¸ë¦¬ê³  ë‚˜ì„œ submit > listë¡œ ë‹¤ì‹œ ê°. ê·¸ë•Œ pageVOë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒ
			//(controllerì—ì„œ pagevoê°€ ë“¤ì–´ê°€ëŠ” ê²ƒ!)
		});
		
    	//ì €ì¥í•˜ê³  ë‚œ í›„ inputì— ì •ë³´ë‚¨ê¸°ê¸°
    	var columnName = ["productName", "productNum", "stockState"];
    	var columnValue = [[${pageVO.keyword}]];  //ë°°ì—´
    	
    	for(var idx = 0; columnValue!=null && idx < columnName.length; idx++){
    		formObj.find("input[name='type']").eq(idx).val(columnName[idx]);
    		formObj.find("input[name='keyword']").eq(idx).val(columnValue[idx]);
    	}
		 
		if(formObj.find("[name='page']").val()==''){
			formObj.find("[name='page']").val(1);
		}
		
		//ì¡°ê±´ ê²€ìƒ‰ì‹œ
		$("#searchBtn").click(function() {
			
			formObj.find("input[name='type']").eq(0).val("productName");
			formObj.find("input[name='type']").eq(1).val("productNum");
			formObj.find("input[name='type']").eq(2).val("stockState");
			 
			formObj.find("input[name='keyword']").eq(0).val($("#searchKeyword1").val());
			formObj.find("input[name='keyword']").eq(1).val($("#searchKeyword2").val());
			formObj.find("input[name='keyword']").eq(2).val($("input:radio[name='stockState']:checked").val());

			if(formObj.find("[name='page']").val()==''){
				formObj.find("[name='page']").val(1);
			}
			formObj.submit();
		});
	
		
		$("#searchBox input").change(function(){ 
			formObj.find("[name='page']").val(1);
		});
		
		//resetBtn ëˆ„ë¥¼ë•Œ
		$("#resetBtn").click(function(){
			var val = $("#searchBox").children('input');
			
			$('input').each(function(index, item){
				if(index < 2) {
					$(item).val('');
					$("input:radio[name ='stockState']:input[value='ì „ì²´']").attr("checked", true);
				}
			});
			$("#f1").find("input[name='page']").val(1);
			$("#searchBtn").click();
		});
		
		//ì „ì²´ sortì‹œ
		$("#sortColumn").change(function(){
			formObj.find("#sort").val($(this).val());
			$("#searchBtn").click();
		});
		
		
		// ì…ê³ ë“±ë¡ ì‹œ ì•Œë¦¼ì°½
 		$("#myfrm").submit(function() {
				if(confirm('ì…ê³  í•˜ì‹œê² ìŠµë‹ˆê¹Œ?') == true){
					return true;
				}
				alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
				return false;
		});
		
		// ì…ê³ ë“±ë¡ ì‹œ í•´ë‹¹í˜ì´ì§€ì •ë³´ ê°€ì ¸ê°€ê¸°
		function checkInputData(){
			$("#myfrm").find("input[name='page']").val($("#f1").find("input[name='page']").val());
			$("#myfrm").find("input[name='size']").val($("#f1").find("input[name='size']").val());
			$("#myfrm").find("input[name='colmnName']").val($("#f1").find("input[name='colmnName']").val());
			for(var i = 0; i <3; i++) {
				$("#myfrm").find("input[name='type']").eq(i).val($("#f1").find("input[name='type']").eq(i).val());
				$("#myfrm").find("input[name='keyword']").eq(i).val($("#f1").find("input[name='keyword']").eq(i).val());
			}
		}
		
		</script>
	</th:block>

		
<!-- 	<th:block layout:fragment="script">
		<script>
			//jQueryëŠ” readyë¥¼ ì—¬ëŸ¬ë²ˆ ì“¸ ìˆ˜ ìˆìŒ. jsëŠ” ë¶ˆê°€ëŠ¥
			
			//modifyModalë„ìš°ê¸°
/* 			$("#myTable").on("click", "tr", function(){
				//ajaxë¡œ ì„œë²„ì— ë‹¤ë…€ì˜¤ê¸° ...ìƒí’ˆì˜ ì˜µì…˜ì„ ê°€ì§€ëŸ¬ê°„ë‹¤. 
/* 				$.ajax({
					url:"/admin/detail/[[${product.productNum}]]",
					data:{"productNum": $(this).find("td")[1].html()},   
					success:function(responseData){
						//JSONì„ ê°€ì ¸ì˜¤ê¸° {"í‚¤":"ê°’ ", , , , , , ,}
						//modalì— setting 
					}
				});
				
				$("#myModal").modal("show");
			}); */

			//
			function fnModuleInfo(str){
			   $('#MoaModal .modal-content').load("moaModal?id="+str);
			   $('#MoaModal').modal();
			}
			
 			//datepicker ì‚¬ìš©
			  $(function(){
			      $('.datepicker').datepicker({
			    	  weekStart: 0,
			    	  clearBtn: true,
			    	  language: "ko",
			    	  orientation: "auto right",
			          keyboardNavigation: false,
			          forceParse: false,
			    	  autoclose: true,
			    	  todayHighlight: true
			      });
			  });

	
		</script>
	</th:block>
 --></body>
</html>