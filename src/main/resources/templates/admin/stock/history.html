<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="admin/layout/layout1">
<head>
<meta charset="UTF-8">
<title>ì…ì¶œê³ ë‚´ì—­</title>
<!-- <th:block layout:fragment="style">
	<style>

	</style>
</th:block> -->


</head>
<body>

	<div layout:fragment="content">
		<h3>ğŸ“‘ ì¬ê³ í˜„í™©</h3>
		<hr>
<!-- 		<div class="mt-4">
			<div class="input-group mb-3">
				<div class="input-group-prepend">
					<span class="input-group-text">ê²€ìƒ‰ì–´</span>
				</div>
				<input type="text" id="searchKeyword1" class="form-control" placeholder="ìƒí’ˆëª… ì…ë ¥" onfocus="this.placeholder=''" onblur="this.placeholder='ìƒí’ˆëª… ì…ë ¥'">
				<input type="text" id="searchKeyword2" class="form-control" placeholder="ìƒí’ˆë²ˆí˜¸ ì…ë ¥" onfocus="this.placeholder=''" onblur="this.placeholder='ìƒí’ˆë²ˆí˜¸ ì…ë ¥'">
			</div>
			<label for="selectPeriod">ê¸°ê°„ì„ íƒ</label>
			<div class="form-row" id="selectPeriod">
				<span >From</span>
			    <div class="col input-group mb-3">
			        <div class="input-group-prepend">
			          <span class="input-group-text"><i class="material-icons">date_range</i></span>
			        </div>
			        <input type="text" class="form-control datepicker" id="datepicker1" placeholder="ë‚ ì§œì„ íƒ" name="datepicker">
			    </div>
			    <div class="mt-2 ml-3 mr-3">
			    	<span class="input-group-addon"><i class="material-icons">play_arrow</i></span>
			    </div>
			    <div class="col input-group mb-3">
			        <div class="input-group-prepend">
			          <span class="input-group-text"><i class="material-icons">date_range</i></span>
			        </div>
			        <input type="text" class="form-control datepicker"  id="datepicker2" placeholder="ë‚ ì§œì„ íƒ" name="datepicker">
			    </div>
			</div>
			<label for="statePosting">ê²Œì‹œìƒíƒœ</label>
			<div id="statePosting">
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio" class="form-check-input" name="postingState" value="ì „ì²´">ì „ì²´</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio" class="form-check-input" value="ê²Œì‹œì¤‘" name="postingState">ê²Œì‹œì¤‘</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio" class="form-check-input" value="ì¼ì‹œì¤‘ë‹¨" name="postingState">ì¼ì‹œì¤‘ë‹¨</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio" class="form-check-input" value="ê²Œì‹œì¢…ë£Œ" name="postingState">ê²Œì‹œì¢…ë£Œ</label>
				</div>
			</div>
			<div class="d-flex justify-content-center mt-3">
				<div>
					<button class="btn btn-info mr-4" id="searchBtn"><i class="material-icons">&nbsp;&nbsp;search&nbsp;&nbsp;</i></button>
				</div>
				<div>
					<button class="btn btn-danger" id="resetBtn"><i class="material-icons">&nbsp;&nbsp;cached&nbsp;&nbsp;</i></button>
				</div>
			</div>
		</div> -->
        
		<!-- 			<img alt="ì´ë¯¸ì§€" th:src="@{/images/coffee-blue.jpg}" width="50px"
				height="50px"> -->
		<div class="p-3 ">
			<hr>
		</div>
		<div>
		    <ul class="nav nav-tabs nav-justified">
		        <li id="historyTab" class="nav-item">
		            <a class="nav-link active" href="#history" style="background-color: #f7edbc;">ì…ê³ ë‚´ì—­</a> <!-- data-toggle="collapse" -->
		        </li>
		        <li id="ordersTab" class="nav-item ">
		            <a class="nav-link" href="#orders">ì¶œê³ ë‚´ì—­</a>
		    	</li>
		 	 </ul>
		</div>
		<div id="history" class="collapse show mt-4">
			<div class="d-flex justify-content-between">
				<div>
					<p th:text="'ì´ ' + ${totalCountP} + 'ê±´'"></p>
				</div>
	
				<div class="form-group" style="float:right; width:190px;">
					<select id = "sortColumn" class="form-control"> <!-- asc desc ê°€ì ¸ê°€ëŠ” ë°©ë²• ì°¾ê¸° -->
						<option value="productCreatedate0">ìµœì‹ ìˆœ</option>
						<option value="productCreatedate1">ê³¼ê±°ìˆœ</option>
						<option value="productName1">ìƒí’ˆëª…(ã„±~ã…)</option>
						<option value="productName0">ìƒí’ˆëª…(ã…~ã„±)</option>
						<option value="productNum1">ìƒí’ˆë²ˆí˜¸(ì˜¤ë¦„ì°¨ìˆœ)</option>
						<option value="productNum0">ìƒí’ˆë²ˆí˜¸(ë‚´ë¦¼ì°¨ìˆœ)</option>
					</select>
				</div>
			</div>
			<table class="table table-bordered table-hover">
				<thead>
					<tr>
						<th>NO.</th>
						<th>ì…ê³ ë²ˆí˜¸</th>
						<th>ìƒí’ˆë²ˆí˜¸</th>
						<th>ìƒí’ˆëª…</th>
						<th>ì˜µì…˜ë²ˆí˜¸</th>
						<th>ì˜µì…˜ëª…</th>
						<th>ë‹¨ê°€</th>
						<th>ì…ê³ ìˆ˜ëŸ‰</th>
						<th>ì…ê³ ì¼ì</th>
						<th>ì…ê³ ì·¨ì†Œ</th>
					</tr>
				</thead>
				
				<tbody id="myTable">
					<tr th:each="p, state:${purchaseHistory.result.content}" >
						<td th:text="${state.count + (purchaseHistory.currentPageNum-1) * purchaseHistory.currentPage.pageSize}"></td>
						<td th:text="${p.purchaseNum}"></td>
						<td th:text="${p.productNum.productNum}"></td>
						<td th:text="${p.productNum.productName}"></td>
						<td th:if="${#strings.isEmpty(p.productOption)}">-</td>
						<td th:if="${!#strings.isEmpty(p.productOption)}" th:text="${p.productOption.optionNum}"></td>
						<td th:if="${#strings.isEmpty(p.productOption)}">-</td>
						<td th:if="${!#strings.isEmpty(p.productOption)}" th:text="${p.productOption.optionName}"></td>
						<td th:if="${#strings.isEmpty(p.productOption)}" th:text="${#numbers.formatInteger(p.productNum.productPrice, 0, 'COMMA')}" ></td>
						<td th:unless="${#strings.isEmpty(p.productOption)}" 
						th:text="${#numbers.formatInteger(p.productNum.productPrice + p.productOption.extraprice, 0, 'COMMA')}" ></td>
<!-- 						th:text="${p.productNum.productPrice} + ${p.productOption.extraprice}" ></td> -->
						<td th:text="${p.purchaseQuantity}"></td>
						<td th:text="${#dates.format(p.purchaseDate, 'yy-MM-dd HH:mm')}"></td>
						<td>
							<a href="#">ì·¨ì†Œ</a>
						</td>
					</tr>
				</tbody>
			</table>
			<nav>
				<div>
					<ul class="pagination justify-content-center">
						<li class="page-item" th:if="${purchaseHistory.prevPage}"><a
							class="page-link" th:href="${purchaseHistory.prevPage.pageNumber}+1">PREV</a>
						</li>
						<li class="page-item"
							th:classappend="${p.pageNumber==purchaseHistory.currentPageNum-1}?active:''"
							th:each="p:${purchaseHistory.pageList}"><a class="page-link"
							th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a></li>
						<li class="page-item" th:if="${purchaseHistory.nextPage}"><a
							class="page-link" th:href="${purchaseHistory.nextPage.pageNumber}+1">NEXT</a>
						</li>
					</ul>
				</div>
			</nav>
		</div>	
		
		<div id="orders" class="collapse mt-4">
			<div class="d-flex justify-content-between">
				<div>
					<p th:text="'ì´ ' + ${totalCountO} + 'ê±´'"></p>
				</div>
	
				<div class="form-group" style="float:right; width:190px;">
					<select id = "sortColumn" class="form-control"> <!-- asc desc ê°€ì ¸ê°€ëŠ” ë°©ë²• ì°¾ê¸° -->
						<option value="productCreatedate0">ìµœì‹ ìˆœ</option>
						<option value="productCreatedate1">ê³¼ê±°ìˆœ</option>
						<option value="productName1">ìƒí’ˆëª…(ã„±~ã…)</option>
						<option value="productName0">ìƒí’ˆëª…(ã…~ã„±)</option>
						<option value="productNum1">ìƒí’ˆë²ˆí˜¸(ì˜¤ë¦„ì°¨ìˆœ)</option>
						<option value="productNum0">ìƒí’ˆë²ˆí˜¸(ë‚´ë¦¼ì°¨ìˆœ)</option>
					</select>
				</div>
			</div>
			<table class="table table-bordered table-hover">
				<thead>
					<tr>
						<th>NO.</th>
						<th>ì£¼ë¬¸ë²ˆí˜¸</th>
						<th>ì£¼ë¬¸ìƒì„¸ë²ˆí˜¸</th>
						<th>ìƒí’ˆë²ˆí˜¸</th>
						<th>ìƒí’ˆëª…</th>
						<th>ì˜µì…˜ë²ˆí˜¸</th>
						<th>ì˜µì…˜ëª…</th>
						<th>ë‹¨ê°€</th>
						<th>ì¶œê³ ìˆ˜ëŸ‰</th>
						<th>ì£¼ë¬¸ì¼ì</th>
						<th>ì£¼ë¬¸ìƒíƒœ</th>
					</tr>
				</thead>
				
				<tbody id="myTable" th:with="num = 0">
					<th:block th:each="order, state:${orderHistory.result.content}" >
					    
						<tr th:each="detail, s:${order.details}" th:with="num = ${num+1}">
<!-- 							<td th:text="${orderHistory.currentPageNum}"></td> -->
							<td class="tdNum"></td>
							<td th:text="${num + (orderHistory.currentPageNum-1) * orderHistory.currentPage.pageSize}"></td>
							<td th:text="${order.orderNum}"></td>
							<td th:text="${detail.orderDetailNum}"></td>
							<td th:text="${detail.productNum.productNum}"></td>
							<td th:text="${detail.productNum.productName}"></td>
							
							<td th:if="${#strings.isEmpty(detail.productOption)}">-</td>
							<td th:if="${!#strings.isEmpty(detail.productOption)}" th:text="${detail.productOption.optionNum}"></td>
							<td th:if="${#strings.isEmpty(detail.productOption)}">-</td>
							<td th:if="${!#strings.isEmpty(detail.productOption)}" th:text="${detail.productOption.optionName}"></td>
	
							<td th:if="${#strings.isEmpty(detail.productOption)}" th:text="${#numbers.formatInteger(detail.productNum.productPrice, 0, 'COMMA')}" ></td>
							<td th:unless="${#strings.isEmpty(detail.productOption)}" 
							th:text="${#numbers.formatInteger(detail.productNum.productPrice + detail.productOption.extraprice, 0, 'COMMA')}" ></td>
							
							<td th:if="${order.orderStatus.toString().equals('êµ¬ë§¤ì·¨ì†Œ')} or ${order.orderStatus.toString().equals('ë°˜í’ˆ')}" th:text="|-${detail.orderDetailQuantity}|"></td>
							<td th:unless="${order.orderStatus.toString().equals('êµ¬ë§¤ì·¨ì†Œ')} or ${order.orderStatus.toString().equals('ë°˜í’ˆ')}" th:text="${detail.orderDetailQuantity}"></td>
							<td th:text="${#dates.format(order.orderDate, 'yy-MM-dd')}"></td>
							<td th:text="${order.orderStatus}"></td>
	
						</tr>
					</th:block>
				</tbody>
			</table>
			<nav>
				<div>
					<ul class="pagination justify-content-center">
						<li class="page-item" th:if="${orderHistory.prevPage}"><a
							class="page-link" th:href="${orderHistory.prevPage.pageNumber}+1">PREV</a>
						</li>
						<li class="page-item"
							th:classappend="${p.pageNumber==orderHistory.currentPageNum-1}?active:''"
							th:each="p:${orderHistory.pageList}"><a class="page-link"
							th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a></li>
						<li class="page-item" th:if="${orderHistory.nextPage}"><a
							class="page-link" th:href="${orderHistory.nextPage.pageNumber}+1">NEXT</a>
						</li>
					</ul>
				</div>
			</nav>
		</div>	
		<!-- paging -->

<!-- 		//ì¶”í›„ hiddenìœ¼ë¡œ ë³€ê²½
		<form id="f1" th:action="@{list}" method="get" >
			<input type="text" name="page" th:value="${stockPaging.currentPageNum}"> 
			<input type="text" name="size" th:value="${stockPaging.currentPage.pageSize}">
			<div th:each="num : ${#numbers.sequence(0,4)}">
				<input type="text" name="type" value=""> 
				<input type="text" name="keyword" value="">
			</div>
			<input type="text" id="sort" name="colmnName" th:value="${sortColumn}">
		</form>
		<div th:insert="~{admin/product/detailsModal :: modifyModal}"></div> -->

	</div> -->
	<th:block layout:fragment="script">
		<script th:inline="javascript">
			$(".tdNum").each(function(index, item){
	    		var trNum = ($(item).closest('tr').prevAll().length +1);
	    		//+ [[${orderHistory.currentPageNum-1}]] * [[${orderHistory.currentPage.pageSize{]]
	            $(item).text(trNum);
    		});
			
			$("#historyTab").click(function(){
				$(this).find("a").addClass("active").css("background-color", "#f7edbc");
				$("#history").addClass("show");
				$("#orders").removeClass("show");
				$("#ordersTab").find("a").removeClass("active").css("background-color", "");
				
			});
			$("#ordersTab").click(function(){
				$(this).find("a").addClass("active").css("background-color", "#f7edbc");
				$("#orders").addClass("show");
				$("#history").removeClass("show");
				$("#historyTab").find("a").removeClass("active").css("background-color", "");
			});
		</script>
	</th:block>

		
<!-- 	<th:block layout:fragment="script">
		<script>
			//jQueryëŠ” readyë¥¼ ì—¬ëŸ¬ë²ˆ ì“¸ ìˆ˜ ìˆìŒ. jsëŠ” ë¶ˆê°€ëŠ¥
			
			//modifyModalë„ìš°ê¸°
/* 			$("#myTable").on("click", "tr", function(){
				//ajaxë¡œ ì„œë²„ì— ë‹¤ë…€ì˜¤ê¸° ...ìƒí’ˆì˜ ì˜µì…˜ì„ ê°€ì§€ëŸ¬ê°„ë‹¤. 
/* 				$.ajax({
					url:"/admin/detail/[[${product.productNum}]]",
					data:{"productNum": $(this).find("td")[1].html()},   
					success:function(responseData){
						//JSONì„ ê°€ì ¸ì˜¤ê¸° {"í‚¤":"ê°’ ", , , , , , ,}
						//modalì— setting 
					}
				});
				
				$("#myModal").modal("show");
			}); */

			//resetBtn ëˆ„ë¥¼ë•Œ
			$(function() {
				$("#resetBtn").click(function(){
					$('input').each(function(index, item){
						console.log()
						$(item).val('');
					});
				});
			});
			
			//
			function fnModuleInfo(str){
			   $('#MoaModal .modal-content').load("moaModal?id="+str);
			   $('#MoaModal').modal();
			}
			
 			//datepicker ì‚¬ìš©
			  $(function(){
			      $('.datepicker').datepicker({
			    	  weekStart: 0,
			    	  clearBtn: true,
			    	  language: "ko",
			    	  orientation: "auto right",
			          keyboardNavigation: false,
			          forceParse: false,
			    	  autoclose: true,
			    	  todayHighlight: true
			      });
			  });

		
			$(function() {
				var formObj = $("#f1");
				
				// ê²Œì‹œê¸€ ì œëª© í´ë¦­ì‹œ ê°’ ë„˜ì–´ê°€ê¸°
				$(".boardLink").click(function(event){ //íƒ€ì´í‹€ì„ ëˆ„ë¥´ë©´
					alert("ë§í¬ëˆ„ë¦„")
		    		event.preventDefault(); //aíƒœê·¸ì˜ ë³¸ë˜ê¸°ëŠ¥ì€ ì·¨ì†Œ 
		    		var bno = $(this).attr("href");
		    		formObj.attr("action", "[[@{detail}]]") //ë””í…Œì¼ë¡œê°€ê¸°
		    		formObj.find($("input[name='bno']")).remove();
		    		formObj.append("<input type='text' name='bno' value='" + bno + "'>" ); //formì—ë‹¤ ì¶”ê°€ ë‚´ìš©ë³´ê³ ì‹¶ë‹¤ë©´ textë¡œ ë³€ê²½
		    		alert("ë§í¬ëˆ„ë¦„")
		    		formObj.submit();
		    		formObj.attr("action", "[[@{list}]]"); //ë‹¤ì‹œ ì›ìƒë³µê·€
		    	});
				
				//ì¡°ê±´ ê²€ìƒ‰ì‹œ
				$("#searchBtn").click(function() {
					
					formObj.find("input[name='type']").eq(0).val("productName");
					formObj.find("input[name='type']").eq(1).val("productNum");
					formObj.find("input[name='type']").eq(2).val("from");
					formObj.find("input[name='type']").eq(3).val("to");
					formObj.find("input[name='type']").eq(4).val("postingState");
					 
					formObj.find("input[name='keyword']").eq(0).val($("#searchKeyword1").val());
					formObj.find("input[name='keyword']").eq(1).val($("#searchKeyword2").val());
					formObj.find("input[name='keyword']").eq(2).val($("#datepicker1").val());
					formObj.find("input[name='keyword']").eq(3).val($("#datepicker2").val());
					formObj.find("input[name='keyword']").eq(4).val($("input:radio[name='postingState']:checked").val());
					//var typeStr = $("#searchType").find(":selected").val();// = $("#searchType").val(), ì¡°ê±´
					//var keywordStr = $("#searchKeyword").val(); //ê²€ìƒ‰ë‚´ìš©
					//formObj.find("[name='type']").val(typeStr); //typeì— ì €ì¥
					//formObj.find("[name='keyword']").val(keywordStr); //keywordì— ì €ì¥
					if(formObj.find("[name='page']").val()==''){
						formObj.find("[name='page']").val(1);
					}
					//formObj.find("[name='page']").val(); //ì²«ë²ˆì§¸ í˜ì´ì§€ ì–»ì€ ê²ƒ
					//alert(typeStr + ":" + keywordStr);
					formObj.submit();
				});
				
				//ì „ì²´ sortì‹œ
				$("#sortColumn").change(function(){
					alert($(this).val());
					formObj.find("#sort").val($(this).val());
					$("#searchBtn").click();
				});
				
				//í˜ì´ì§€ í´ë¦­ì‹œ
				$(".pagination a").click(function(e) { //í´ë˜ìŠ¤ pagination ìì‹ì¤‘ a í´ë¦­ì‹œ 
					alert($(this).attr('href'));
					e.preventDefault(); //ë§í¬ì·¨ì†Œ
					formObj.find("[name='page']").val($(this).attr('href'));
					$("#searchBtn").click(); //í˜ì´ì§€ë§Œë‹¬ë¼ì§€ê³  ë‹¤ì‹œ ì¡°íšŒ
					//ë‹¤ì‹œ ê·¸ í¼ì—ì„œ ì´ë¦„ì´ pageì¸ê±¸ ì°¾ì•„ì„œ hrefê°€ ê°€ì§€ê³  ìˆëŠ” ìˆ«ìë¥¼ page(this) ê°’ìœ¼ë¡œ ë„£ì–´ì¤Œ
					//formObj.submit(); //ê·¸ë¦¬ê³  ë‚˜ì„œ submit > listë¡œ ë‹¤ì‹œ ê°. ê·¸ë•Œ pageVOë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒ
					//(controllerì—ì„œ pagevoê°€ ë“¤ì–´ê°€ëŠ” ê²ƒ!)
				});
			});
			
			//table sort(columnName í´ë¦­ì‹œ sort)
			$(document).ready(function(){ 
				$('#prdlist th').each(function (column) { 
					$(this).click(function() { 
						if($(this).is('.asc')) { 
							$(this).removeClass('asc'); 
							$(this).addClass('desc'); 
							sortdir=-1; 
						} else { 
							$(this).addClass('asc'); 
							$(this).removeClass('desc'); 
							sortdir=1; 
						} 
						
						$(this).siblings().removeClass('asc'); 
						$(this).siblings().removeClass('desc'); 
						var rec = $('#prdlist').find('tbody>tr').get(); 
						
						rec.sort(function (a, b) { 
							var val1 = $(a).children('td').eq(column).text().toUpperCase(); 
							var val2 = $(b).children('td').eq(column).text().toUpperCase(); 
							return (val1 < val2)?-sortdir:(val1>val2)?sortdir:0; 
						}); 
						$.each(rec, function(index, row) { 
							$('#prdlist tbody').append(row);
							}); 
						}); 
					}); 
				});

		</script>
	</th:block>
 --></body>
</html>