<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="admin/layout/layout1">
<head>
<meta charset="UTF-8">
<title>ìƒí’ˆëª©ë¡</title>
<th:block layout:fragment="style">
	<style>
.fileBox .fileName {
	background-color: #fff;
}

input{
	background-color: #fff;
}


 .fileBox input[type="file"] {
	position: absolute;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0, 0, 0, 0);
	border: 0
}



</style>
</th:block>

</head>
<body>

	<div layout:fragment="content">
		<h3>ğŸ“‘ ìƒí’ˆëª©ë¡</h3>
		<hr class="mb-5">
		<div id="searchBox" class="mt-4">
			<div class="input-group mb-4">
				<div class="input-group-prepend">
					<span class="input-group-text">ê²€ìƒ‰ì–´</span>
				</div>
				<input type="text" id="searchKeyword1" class="form-control"
					th:value="${pageVO.keyword!=null?pageVO.keyword[0]:''}"
					placeholder="ìƒí’ˆëª… ì…ë ¥" onfocus="this.placeholder=''"
					onblur="this.placeholder='ìƒí’ˆëª… ì…ë ¥'"> <input type="text"
					id="searchKeyword2" class="form-control"
					th:value="${pageVO.keyword!=null?pageVO.keyword[1]:''}"
					placeholder="ìƒí’ˆë²ˆí˜¸ ì…ë ¥" onfocus="this.placeholder=''"
					onblur="this.placeholder='ìƒí’ˆë²ˆí˜¸ ì…ë ¥'">
			</div>
			<label for="selectPeriod">ìƒí’ˆë“±ë¡ê¸°ê°„</label>
			<div class="form-row mb-2" id="selectPeriod">
				<!-- <span >From</span> -->
				<div class="col input-group mb-3">
					<div class="input-group-prepend">
						<span class="input-group-text"><i class="material-icons">date_range</i></span>
					</div>
					<input type="text" class="form-control datepicker" id="datepicker1"
						placeholder="&nbsp;ë‚ ì§œì„ íƒ" name="datepicker"
						th:value="${pageVO.keyword!=null?pageVO.keyword[2]:''}">
				</div>
				<div class="mt-2 ml-3 mr-3">
					<span class="input-group-addon"><i class="material-icons">play_arrow</i></span>
				</div>
				<div class="col input-group mb-3">
					<div class="input-group-prepend">
						<span class="input-group-text"><i class="material-icons">date_range</i></span>
					</div>
					<input type="text" class="form-control datepicker" id="datepicker2"
						placeholder="&nbsp;ë‚ ì§œì„ íƒ" name="datepicker"
						th:value="${pageVO.keyword!=null?pageVO.keyword[3]:''}">
				</div>
			</div>
			<label for="statePosting">ê²Œì‹œìƒíƒœ</label>
			<div id="statePosting">
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio"
						class="form-check-input" id="all" name="postingState" value="ì „ì²´"
						th:checked="${pageVO.keyword==null || pageVO.keyword[4]=='ì „ì²´'}">ì „ì²´</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio"
						class="form-check-input" value="ì •ìƒ" name="postingState"
						th:checked="${pageVO.keyword!=null && pageVO.keyword[4]=='ì •ìƒ'}">ì •ìƒ</label>
				</div>
				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio"
						class="form-check-input" value="í’ˆì ˆ" name="postingState"
						th:checked="${pageVO.keyword!=null && pageVO.keyword[4]=='í’ˆì ˆ'}">í’ˆì ˆ</label>
				</div>
				<!-- 				<div class="form-check-inline">
					<label class="form-check-label"><input type="radio" class="form-check-input" value="ê²Œì‹œì¢…ë£Œ" name="postingState" th:checked="${pageVO.keyword!=null && pageVO.keyword[4]=='ê²Œì‹œì¢…ë£Œ'}">ê²Œì‹œì¢…ë£Œ</label>
				</div> -->
			</div>
			<div class="d-flex justify-content-center mt-4">
				<div>
					<button class="btn mr-3" id="searchBtn"
						style="background-color: #f7edbc">
						<i class="material-icons pt-2 pl-3 pr-3">&nbsp;&nbsp;search&nbsp;&nbsp;</i>
					</button>
				</div>
				<div>
					<button class="btn" id="resetBtn"
						style="background-color: #fcc0c5;">
						<i class="material-icons pt-2 pl-3 pr-3">&nbsp;&nbsp;cached&nbsp;&nbsp;</i>
					</button>
				</div>
			</div>
		</div>

		<!-- 			<img alt="ì´ë¯¸ì§€" th:src="@{/images/coffee-blue.jpg}" width="50px"
				height="50px"> -->

		<hr class="mt-4 mb-5">
		<div></div>
		<div class="d-flex justify-content-between">
			<div>
				<p th:text="'ì´ ' + ${totalCount} + 'ê±´'"></p>
			</div>
			<div class="form-group" style="float: right; width: 190px;">
				<select id="sortColumn" class="form-control">
					<!-- asc desc ê°€ì ¸ê°€ëŠ” ë°©ë²• ì°¾ê¸° -->
					<option value="productCreatedate0"
						th:selected="${sortColumn=='productCreatedate0'}">ìµœì‹ ìˆœ</option>
					<option value="productCreatedate1"
						th:selected="${sortColumn=='productCreatedate1'}">ê³¼ê±°ìˆœ</option>
					<option value="productName1"
						th:selected="${sortColumn=='productName1'}">ìƒí’ˆëª…(ã„±~ã…)</option>
					<option value="productName0"
						th:selected="${sortColumn=='productName0'}">ìƒí’ˆëª…(ã…~ã„±)</option>
					<option value="productNum1"
						th:selected="${sortColumn=='productNum1'}">ìƒí’ˆë²ˆí˜¸(ì˜¤ë¦„ì°¨ìˆœ)</option>
					<option value="productNum0"
						th:selected="${sortColumn=='productNum0'}">ìƒí’ˆë²ˆí˜¸(ë‚´ë¦¼ì°¨ìˆœ)</option>
				</select>
			</div>
		</div>
		<div>
			<table id="prdlist" class="table table-bordered table-hover">
				<thead>
					<tr>
						<th>No.</th>
						<th>ìƒí’ˆë²ˆí˜¸</th>
						<th>ìƒí’ˆì´ë¯¸ì§€</th>
						<th>ìƒí’ˆëª…</th>
						<th>ë“±ë¡ì¼</th>
						<th>ê²Œì‹œìƒíƒœ</th>
						<th>í™ˆí˜ì´ì§€</th>
					</tr>
				</thead>
				<tbody id="myTable">
					<tr th:if="${#lists.size(productPaging.result.content)}==0">
						<td colspan="7" align="center">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
					</tr>
					<tr th:each="product, pstate:${productPaging.result.content}">
						<!-- ê°ì²´, status(ë°˜ë³µìƒíƒœë³€ìˆ˜)  -->
						<td
							th:text="${pstate.count + (productPaging.currentPageNum-1) * productPaging.currentPage.pageSize}"></td>
						<td th:text="${product.productNum}"></td>
						<td align="center" th:if="${#strings.startsWith(product.productMainimg1,'https')}">
							<img th:src="${product.productMainimg1}" width="80" height="80">
						</td>
						<td align="center" th:unless="${#strings.startsWith(product.productMainimg1,'https')}">
							<img th:src="|/${product.productMainimg1}|" width="80" height="80">
						</td>
						<td th:text="${product.productName}"></td>
						<td th:text="${#dates.format(product.productCreatedate, 'yyyy-MM-dd')}"></td>
						<td th:text="${product.postingState}"></td>
						<td><a th:href="@{/productdetail(pno=${product.productNum})}"
							onclick="event.cancelBubble=true" target='_blank'>ë°”ë¡œê°€ê¸°</a></td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- paging -->
		<nav>
			<div>
				<ul class="pagination justify-content-center">
					<li class="page-item" th:if="${productPaging.prevPage}"><a
						class="page-link" th:href="${productPaging.prevPage.pageNumber}+1">PREV</a>
					</li>
					<li class="page-item"
						th:classappend="${p.pageNumber==productPaging.currentPageNum-1}?active:''"
						th:each="p:${productPaging.pageList}"><a class="page-link"
						th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a></li>
					<li class="page-item" th:if="${productPaging.nextPage}"><a
						class="page-link" th:href="${productPaging.nextPage.pageNumber}+1">NEXT</a>
					</li>
				</ul>
			</div>
		</nav>
		<!-- hidden ë³€ê²½ -->
		<form id="f1" th:action="@{list}" method="get">
			<input type="hidden" name="page"
				th:value="${productPaging.currentPageNum}"> <input
				type="hidden" name="size"
				th:value="${productPaging.currentPage.pageSize}">
			<div th:each="num : ${#numbers.sequence(0,4)}">
				<input type="hidden" name="type" value=""> <input
					type="hidden" name="keyword" value="">
			</div>
			<input type="hidden" id="sort" name="colmnName"
				th:value="${sortColumn}">
		</form>
		<div th:insert="~{admin/product/detailModal :: detailModal}"></div>
	</div>

	<th:block layout:fragment="script">
		<script th:inline="javascript">
			//jQueryëŠ” readyë¥¼ ì—¬ëŸ¬ë²ˆ ì“¸ ìˆ˜ ìˆìŒ. jsëŠ” ë¶ˆê°€ëŠ¥
			//ìˆ˜ì •ì™„ë£Œ alert
			$(function() {
				var msg = [[${result}]];
				if(msg != null) {
					alert(msg);
				}
		
				//modal ë„ìš°ê¸°
				$("#myTable").on("click", "tr", function(){
				    
					var tds = $(this).find("td");
			    	var rno = tds[1].innerHTML;
					
					$.ajax({
			            url:"/admin/detail?productNum=" + rno,
			            success:function(responseData){
							//ëª¨ë‹¬ì—´ê¸° ì „ì— ì˜µì…˜ ì§€ìš°ê¸°
							$("#addOptions").empty();
							$("#optionNum").val("");
							$("#optionCategory option:eq(0)").prop("selected", true);
			             	$("input[name='optionName']").val("");
			                $("input[name='optionPrice']").val("");
							putDataList(responseData);
							$("#myModal").modal("show");
			            }
			        });
				});
				
				function putDataList(responseData){
					var product = responseData.product; 
					var option = responseData.productOption;
					$("input[name='productNum']").val(product.productNum);
	                $("input[name='productName']").val(product.productName);
	                $("input[name='productPrice']").val(Number(product.productPrice).toLocaleString('en').split(".")[0]);
	                $("input[name='productCreatedate2']").val(product.productCreatedate);
	                $("input[name='productUpdatedate2']").val(product.productUpdatedate);
					
					$("input[name='file']").eq(0).val(product.productMainimg1);
					$("input[name='file']").eq(1).val(product.productMainimg2);
					$("input[name='file']").eq(2).val(product.productMainimg3);
					$("input[name='file']").eq(3).val(product.productMainimg4);
					$("input[name='file']").eq(4).val(product.productDetailimg);
	                
	                //ì²´í¬ë°•ìŠ¤ ê°€ì ¸ì˜¤ê¸°
	                 
	                $('input:checkbox[name=productCategory]').each(function(index, item){
	                	 
	                	if($.inArray($(item).val(), product.productCategory) >= 0 ){
	                		$(item).prop("checked", true);
	                	} else {
	                		$(item).prop("checked", false);
	                	}
	                });
	                
	                //ì˜µì…˜ê´€ë ¨
	                //ì˜µì…˜ ì—†ì„ë•Œ
	             	if(option == null || option == "") {
	             		$('#optionNo').prop("checked",true);
	             		$("#demo").css("display", "none");
	             		
	             	} else {
		                //ì˜µì…˜ ìˆì„ë•Œ
		                
		             	$('#optionYes').prop("checked",true);
						$("#demo").css("display", "block");
		                var categories = $('#optionCategory').find('option').map(function() {return $(this).val();}).get();
		                var checkCategory = categories.includes(option[0].optionCategory);
		                if(checkCategory == false){
		                	$('#optionCategory').val('Other').prop("selected",true);
		                	$("#writeOther").attr("type", "text");
		                	$("#writeOther").val(option[0].optionCategory);
		                } else {
		                	$('#optionCategory').val(option[0].optionCategory).prop("selected",true);
		                }
		                $("input[name='optionName']").val(option[0].optionName);
		                $("input[name='optionPrice']").val(Number(option[0].extraprice).toLocaleString('en').split(".")[0]);
						
		                
						for(var idx = 1; idx < option.length; idx++){
							var copyObj = $("#option2").clone(true);
							copyObj.appendTo("#addOptions");
							 $("input[name='optionName']").eq(idx).val(option[idx].optionName);
				             $("input[name='optionPrice']").eq(idx).val(Number(option[idx].extraprice).toLocaleString('en').split(".")[0]);
				             $("input[name='optionNum']").eq(idx).val(option[idx].optionNum);
						}

						//ì‚­ì œë²„íŠ¼ 1ë²ˆì§¸ x 2ë²ˆì§¸ë¶€í„° o
						$(".deleteBtn").css("display", "block");
						$(".deleteBtn").first().css("display", "none");
						 //í´ë¡ ì‹œ ì˜µì…˜ë¼ë²¨ ë³´ì—¬ì£¼ì§€ ì•Šê¸°
						$(".optLable").css("display", "none");
						$(".optLable").slice(0, 2).css("display", "block");
						 // optionNum ìˆì„ ë•Œ, ì‚­ì œì‹œ value ""ë¡œ ë³€ê²½í›„ hidden
						$('.deleteBtn').on('click', function () { 
					        if($(this).parent().next().children().val() != null) { //ì˜µì…˜ë²ˆí˜¸
					        	$(this).parent().parent().find(".optionPrice").val("").attr("hidden", true);
					        	$(this).parent().parent().find("#optionName").val("").attr("hidden", true);
					        	$(this).parent().parent().find("#addOptionBtn").attr("hidden", true);
					        	$(this).parent().parent().find("#deleteOption").attr("hidden", true);
					        	$(this).parent().parent().find("#optionNum").attr("hidden", true);
					        } 
					     });

	             	}
				}
				
				
				//resetBtn ëˆ„ë¥¼ë•Œ
				$("#resetBtn").click(function(){
					var val = $("#searchBox").children('input');
					
					$('input').each(function(index, item){
						if(index < 4) {
							$(item).val('');
							$("input:radio[name ='postingState']:input[value='ì „ì²´']").attr("checked", true);
						}
					});
					$("#f1").find("input[name='page']").val(1);
					$("#searchBtn").click();
				});
				
				//datepicker ì‚¬ìš©
				$('.datepicker').datepicker({
			    	  weekStart: 0,
			    	  clearBtn: true,
			    	  language: "ko",
			    	  orientation: "bottom right",
			          keyboardNavigation: false,
			          forceParse: false,
			    	  autoclose: true,
			    	  todayBtn: "linked",
			    	  todayHighlight: true
			      });
			});
			
		
			$(function() {
				var formObj = $("#f1");
				
		    	//ì €ì¥í•˜ê³  ë‚œ í›„ inputì— ì •ë³´ë‚¨ê¸°ê¸°
		    	var columnName = ["productName", "productNum", "from", "to", "postingState"];
		    	var columnValue = [[${pageVO.keyword}]];  //ë°°ì—´
		    	
		    	for(var idx = 0; columnValue!=null && idx < columnName.length; idx++){
		    		formObj.find("input[name='type']").eq(idx).val(columnName[idx]);
		    		formObj.find("input[name='keyword']").eq(idx).val(columnValue[idx]);
		    	}
				 
				if(formObj.find("[name='page']").val()==''){
					formObj.find("[name='page']").val(1);
				}
				
				//ì¡°ê±´ ê²€ìƒ‰ì‹œ
				 
				$("#searchBtn").click(function() {
					
					formObj.find("input[name='type']").eq(0).val("productName");
					formObj.find("input[name='type']").eq(1).val("productNum");
					formObj.find("input[name='type']").eq(2).val("from");
					formObj.find("input[name='type']").eq(3).val("to");
					formObj.find("input[name='type']").eq(4).val("postingState");
					 
					formObj.find("input[name='keyword']").eq(0).val($("#searchKeyword1").val());
					formObj.find("input[name='keyword']").eq(1).val($("#searchKeyword2").val());
					formObj.find("input[name='keyword']").eq(2).val($("#datepicker1").val());
					formObj.find("input[name='keyword']").eq(3).val($("#datepicker2").val());
					formObj.find("input[name='keyword']").eq(4).val($("input:radio[name='postingState']:checked").val());
					
					if(formObj.find("[name='page']").val()==''){
						formObj.find("[name='page']").val(1);
					}
					
					formObj.submit();
				});
				
				
				$("#searchBox input").change(function(){ //ê°’ì´ ë°”ê»´ì„œ ì»¤ì„œê°€ ë°”ê»´ì•¼í•¨.(change)
					formObj.find("[name='page']").val(1);
				});
				
				//ì „ì²´ sortì‹œ
				$("#sortColumn").change(function(){
					formObj.find("#sort").val($(this).val());
					$("#searchBtn").click();
				});
				
				//í˜ì´ì§€ í´ë¦­ì‹œ
				$(".pagination a").click(function(e) { //í´ë˜ìŠ¤ pagination ìì‹ì¤‘ a í´ë¦­ì‹œ 
					e.preventDefault(); //ë§í¬ì·¨ì†Œ
					formObj.find("[name='page']").val($(this).attr('href'));
					 
					$("#searchBtn").click(); //í˜ì´ì§€ë§Œë‹¬ë¼ì§€ê³  ë‹¤ì‹œ ì¡°íšŒ
					
					//ë‹¤ì‹œ ê·¸ í¼ì—ì„œ ì´ë¦„ì´ pageì¸ê±¸ ì°¾ì•„ì„œ hrefê°€ ê°€ì§€ê³  ìˆëŠ” ìˆ«ìë¥¼ page(this) ê°’ìœ¼ë¡œ ë„£ì–´ì¤Œ
					//formObj.submit(); //ê·¸ë¦¬ê³  ë‚˜ì„œ submit > listë¡œ ë‹¤ì‹œ ê°. ê·¸ë•Œ pageVOë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒ
					//(controllerì—ì„œ pagevoê°€ ë“¤ì–´ê°€ëŠ” ê²ƒ!)
				});
			});
			
/* 			//table sort(columnName í´ë¦­ì‹œ sort)
			$(document).ready(function(){ 
				$('#prdlist th').each(function (column) { 
					$(this).click(function() { 
						if($(this).is('.asc')) { 
							$(this).removeClass('asc'); 
							$(this).addClass('desc');
							//th.appendChild('<i class="material-icons">expand_less</i>');
							sortdir=-1; 
						} else { 
							$(this).addClass('asc'); 
							$(this).removeClass('desc'); 
							sortdir=1; 
						} 
						
						$(this).siblings().removeClass('asc'); 
						$(this).siblings().removeClass('desc'); 
						var rec = $('#prdlist').find('tbody>tr').get(); 
						
						rec.sort(function (a, b) { 
							var val1 = $(a).children('td').eq(column).text().toUpperCase(); 
							var val2 = $(b).children('td').eq(column).text().toUpperCase(); 
							return (val1 < val2)?-sortdir:(val1>val2)?sortdir:0; 
						}); 
						$.each(rec, function(index, row) { 
							$('#prdlist tbody').append(row);
							}); 
						}); 
					}); 
				}); */

		</script>
	</th:block>
</body>
</html>