<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="user/layout/layout_main">
<head>
<meta charset="UTF-8">
<title>장바구니목록</title>

</head>
<body>
	<!-- 재정의 받는 곳-->
	<div class="panel panel-default" layout:fragment="content" align="center">
		<table  class="table table-striped table-bordered table-hover" >
			<tr>
				<th>	            	
					<input type="checkbox" id="checkall" onclick="checkAll()">전체선택					
	            </th>		 
				<th>이미지</th>
				<th>상품명</th> 
				<th>수량</th> 
				<th>단가</th> 
				<th>총금액</th> 
				<th></th>
				<th></th>
			</tr>
		<tr th:each="cart:${clist}">
			<td>
				<input type="checkbox" name="cartChkBox" >			
			</td>
			
			<td >
				<img th:src="${cart[0]}" th:width="150">
			</td>
			<td th:text="${cart[1]}"></td>
			
			
			<td>
			<input type='button' th:onclick='count("minus")' value='-'/> 
			<span th:id="count" th:text="${cart[2]}"></span>      		
       		<input type='button' th:onclick='count("plus")' value='+'/>
       		<button th:id="modifyCount">수정</button>      		
       		</td>
			<td th:id="price" th:text="${#numbers.formatInteger(cart[3],0,'COMMA')}+'원'"></td>
			<td th:id="totalPrice" th:text="${#numbers.formatInteger(cart[4],0,'COMMA')}+'원'"></td>			
			
			<td>
			<button type="button" class="btn btn-danger btndelete" 
			       th:onclick="javascript:deleteCart([[${cart[5]}]])">삭제</button> 
			</td>
			<td th:id="cartnum" th:text="${cart[5]}"></td>
		</tr>
		</table>
		<h2 class="text-center">
			총 주문 금액:<span id="orderTotalPrice" class="text-danger">0원</span>
		</h2>
		<button>전체상품주문</button>		
		<button>선택상품주문</button>		
	</div>
<th:block layout:fragment="script">
	<script>
	function deleteCart(cartNo){
		alert(cartNo);
		location.href="cart/delete?cartNum=" + cartNo;		 
	}
	
	function count(type)  {
		  // 결과를 표시할 element
		  const resultElement = document.getElementById('count');//수량
		  const resultPrice = document.getElementById('price');//단가
		  const resultTotalPrice = document.getElementById('totalPrice');//총금액
		  
		  console.log(resultElement);
		  console.log(resultPrice);
		  console.log(resultTotalPrice);
		  
		  // 현재 화면에 표시된 값
		  let number = resultElement.innerText;//수량
		  let price = resultPrice.innerText.replace(',','').replace('원','');//단가
		  let totalPrice = resultTotalPrice.innerText;//총금액
		  console.log(number);
		  console.log(resultPrice.innerText.replace(',','').replace('원',''));
		  		  
		  // 더하기/빼기
		  if(type === 'plus') {
		    number = parseInt(number) + 1;
		  }else if(type === 'minus')  {
		    number = parseInt(number) - 1;
		  }
		  
		  // 결과 출력
		  resultElement.innerText = number;
		  resultTotalPrice.innerText = number * price;
		}
	
	$(document).ready(function(){//주문상품 체크하거나 해제할 경우 총 주문액
		$("input[name='cartChkBox']").change(function(){			 
			getOrderTotalPrice();
		});
	});
	
	function getOrderTotalPrice(){//총 주문 금액 구하는 함수
		var orderTotalPrice = 0;
	 
		$("input[name='cartChkBox']:checked").each(function(index, item){//현재 체크된 장바구니의 상품들의 가격과 수량 곱해서 총 주문액 계산
			//var cartNum = $(this).val();			
			var price = Number($(this).parent().parent().find("#price").html().replace(',','').replace('원',''));			
			var count = Number($(this).parent().parent().find("#count").html());
						
		    console.log(price);
		    console.log(count);
		    orderTotalPrice += price*count;
			if(orderTotalPrice>=100000){
				console.log(orderTotalPrice);
			}else{
				orderTotalPrice+=2500;
			}
		     
		});
		$("#orderTotalPrice").html(orderTotalPrice+'원');
	}
	
	/*function changeCount(obj){//장바구니에 들어있는 수량 변경시 상품 가격과 수량 곱해줌
		
		getOrderTotalPrice();
	}*/
	
	function checkAll(){//전체 체크하거나 해제
		if($("#checkall").prop("checked")){
			$("input[name='cartChkBox']").prop("checked", true);
		}else{
			$("input[name='cartChkBox']").prop("checked", false);
		}
		getOrderTotalPrice();//변경된 총 주문 금액 계산하기 위해서
	}
	</script>
</th:block> 
</body>
</html>    


