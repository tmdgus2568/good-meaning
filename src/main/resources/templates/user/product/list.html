<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="~{/layout/layout1}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div class="panel panel-default" layout:fragment="content1">
		<button onclick="location.href='register'">게시판쓰기</button>
		<a th:href="@{/register}">게시판쓰기</a>
		<p>[[${msg}]]</p>
		<div class="pull-left">
			<select id="searchType">
				<option>전체</option>
				<option value="title" th:selected="${pageVO.type=='title'}">제목</option>
				<option value="content" th:selected="${pageVO.type=='content'}">내용</option>
				<option value="writer" th:selected="${pageVO.type=='writer'}">작성자</option>
			</select> <input type="text" id="searchKeyword">
			<button id="searchBtn">조건검색</button>
			<img alt="이미지" th:src="@{/images/mouse.png}" width="50px"
				height="50px">
		</div>

		<table class="table table-striped table-bordered table-hover">
			<tr>
				<th>bno</th>
				<th>title</th>
				<th>writer</th>
				<th>regdate</th>
				<th>delete</th>
			</tr>
			<tr th:each="board:${blist.result.content}">
				<td><a a class="boardLink" th:href="${board.bno}">[[${board.bno}]]</a>
					<span class="badge"> [[${board.replies.size()}]]</span></td>
				<td><a class="boardLink" th:href="${board.bno}"
					th:text="${board.title}"></a></td>
				<td th:text="${board.writer}"></td>
				<td th:text="${#dates.format(board.regdate, 'yyyy-MM-dd')}"></td>
				<td><a th:href="@{/delete(bno=${board.bno})}">삭제</a></td>
			</tr>
		</table>

		<!-- paging -->
		<nav>
			<div>
				<ul class="pagination">
					<li class="page-item" th:if="${blist.prevPage}"><a
						th:href="${blist.prevPage.pageNumber}+1">PREV
							[[${blist.prevPage.pageNumber}+1]]</a></li>
					<li class="page-item"
						th:classappend="${p.pageNumber==blist.currentPageNum-1}?active:''"
						th:each="p:${blist.pageList}"><a th:href="${p.pageNumber}+1">[[${p.pageNumber}+1]]</a>
					</li>
					<li class="page-item" th:if="${blist.nextPage}"><a
						th:href="${blist.nextPage.pageNumber}+1">NEXT
							[[${blist.nextPage.pageNumber}+1]]</a></li>
				</ul>
			</div>
		</nav>
		<form id="f1" th:action="@{list}" method="get">
			<input type="hidden" name="page" th:value="${blist.currentPageNum}">
			<input type="hidden" name="size" th:value="${blist.currentPage.pageSize}"> 
			<input type="hidden" name="type" th:value="${pageVO.type}"> 
			<input type="hidden" name="keyword" th:value="${pageVO.keyword}">
		</form>
	</div>

	<th:block layout:fragment="script1">
		<script>
			$(function() {
				var formObj = $("#f1");

				$(".boardLink")
						.click(
								function(event) {
									//alert("링크누름")
									event.preventDefault(); //a태그의 본래기능은 취소
									var bno = $(this).attr("href");
									formObj.attr("action", "[[@{detail}]]")
									formObj.remove($("input[name='bno']"));
									formObj.append("<input type='text' name='bno' value='" + bno + "'>")
									formObj.submit();
									formObj.attr("action", "[[@{list}]]")
								});

				$("#searchBtn").click(function() {
					var typeStr = $("#searchType").find(":selected").val(); //$("#searchType").val()
					var keywordStr = $("#searchKeyword").val();
					formObj.find("[name='type']").val(typeStr);
					formObj.find("[name='keyword']").val(keywordStr);
					formObj.find("[name='page']").val(1);
					formObj.submit();
				});

				$(".pagination a").click(function(e) {
					alert($(this).attr('href'));
					e.preventDefault();
					formObj.find("[name='page']").val($(this).attr('href'));
					formObj.submit();
				});
			});
		</script>
	</th:block>
</body>
</html>